-- Giả định đây là phần chính của Framework với các chức năng đã tích hợp như bạn yêu cầu

local Framework = {}
Framework.__index = Framework

local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local function CreateRGBFrame(parent)
    local frame = Instance.new("Frame")
    frame.Name = "RGBBorder"
    frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    frame.BorderSizePixel = 0
    frame.Position = UDim2.new(0, -4, 0, -4)
    frame.Size = UDim2.new(1, 8, 1, 8)
    frame.ZIndex = 0
    frame.Parent = parent

    local uiGradient = Instance.new("UIGradient", frame)
    uiGradient.Rotation = 0
    uiGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
        ColorSequenceKeypoint.new(0.2, Color3.fromRGB(255, 255, 0)),
        ColorSequenceKeypoint.new(0.4, Color3.fromRGB(0, 255, 0)),
        ColorSequenceKeypoint.new(0.6, Color3.fromRGB(0, 255, 255)),
        ColorSequenceKeypoint.new(0.8, Color3.fromRGB(0, 0, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 255))
    }

    RunService.RenderStepped:Connect(function()
        uiGradient.Rotation = (uiGradient.Rotation + 1) % 360
    end)

    return frame
end

function Framework:CreateWindow(options)
    local self = setmetatable({}, Framework)
    local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
    ScreenGui.Name = "FrameworkUI"
    ScreenGui.ResetOnSpawn = false

    local Main = Instance.new("Frame", ScreenGui)
    Main.Name = "Main"
    Main.Size = UDim2.new(0, 500, 0, 400)
    Main.Position = UDim2.new(0.5, -250, 0.5, -200)
    Main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Main.AnchorPoint = Vector2.new(0.5, 0.5)
    Main.ClipsDescendants = false

    CreateRGBFrame(Main)

    local TabFrame = Instance.new("Frame", Main)
    TabFrame.Name = "TabFrame"
    TabFrame.Size = UDim2.new(0, 130, 1, 0)
    TabFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    TabFrame.BorderSizePixel = 0

    local ContentFrame = Instance.new("Frame", Main)
    ContentFrame.Name = "ContentFrame"
    ContentFrame.Position = UDim2.new(0, 130, 0, 0)
    ContentFrame.Size = UDim2.new(1, -130, 1, 0)
    ContentFrame.BackgroundTransparency = 1

    -- Menu Drag (cả nội dung lẫn tab)
    local dragging, offset
    local function drag(input)
        dragging = true
        offset = input.Position - Main.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
    Main.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            drag(input)
        end
    end)
    UIS.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            Main.Position = UDim2.new(0, input.Position.X - offset.X, 0, input.Position.Y - offset.Y)
        end
    end)

    self.Main = Main
    self.TabFrame = TabFrame
    self.ContentFrame = ContentFrame
    self.CurrentTab = nil
    self.Tabs = {}
    self.Keybind = options.ToggleUIKeybind or "K"

    -- Toggle UI
    UIS.InputBegan:Connect(function(input)
        if input.KeyCode.Name == self.Keybind then
            Main.Visible = not Main.Visible
        end
    end)

    function self:ToggleRGB(state)
        local border = Main:FindFirstChild("RGBBorder")
        if border then border.Visible = state end
    end

    function self:CreateTab(name)
        local TabButton = Instance.new("TextButton", TabFrame)
        TabButton.Text = name
        TabButton.Size = UDim2.new(1, 0, 0, 30)
        TabButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)

        local TabContent = Instance.new("Frame", ContentFrame)
        TabContent.Name = name
        TabContent.Size = UDim2.new(1, 0, 1, 0)
        TabContent.Visible = false

        local Tab = {}
        function Tab:CreateButton(data)
            local btn = Instance.new("TextButton", TabContent)
            btn.Text = data.Name
            btn.Size = UDim2.new(0, 200, 0, 30)
            btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            btn.MouseButton1Click:Connect(data.Callback)
        end

        function Tab:CreateKeybind(data)
            local btn = Instance.new("TextButton", TabContent)
            btn.Text = data.Name .. ": " .. self.Keybind
            btn.Size = UDim2.new(0, 200, 0, 30)
            btn.Position = UDim2.new(0, 0, 0, 40)
            btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            btn.MouseButton1Click:Connect(function()
                btn.Text = "Press key..."
                local connection
                connection = UIS.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.Keyboard then
                        self.Keybind = input.KeyCode.Name
                        btn.Text = data.Name .. ": " .. self.Keybind
                        connection:Disconnect()
                    end
                end)
            end)
        end

        TabButton.MouseButton1Click:Connect(function()
            if self.CurrentTab == TabContent then
                TabContent.Visible = false
                self.CurrentTab = nil
            else
                for _, v in pairs(ContentFrame:GetChildren()) do
                    v.Visible = false
                end
                TabContent.Visible = true
                self.CurrentTab = TabContent
            end
        end)

        self.Tabs[name] = Tab
        return Tab
    end

    -- Nút Setting cố định
    local GearButton = Instance.new("ImageButton", Main)
    GearButton.Name = "SettingsGear"
    GearButton.Size = UDim2.new(0, 24, 0, 24)
    GearButton.Position = UDim2.new(1, -28, 0, 4)
    GearButton.BackgroundTransparency = 1
    GearButton.Image = "rbxassetid://6031091002" -- icon bánh răng

    local SettingTab = self:CreateTab("Setting")
    GearButton.MouseButton1Click:Connect(function()
        for _, v in pairs(ContentFrame:GetChildren()) do v.Visible = false end
        SettingTabButton = TabFrame:FindFirstChild("Setting")
        if SettingTabButton then SettingTabButton.Visible = true end
        self.CurrentTab = SettingTab
        SettingTab.Visible = true
    end)

    SettingTab:CreateKeybind({
        Name = "Toggle UI Key"
    })
    SettingTab:CreateButton({
        Name = "Toggle RGB Border",
        Callback = function()
            local border = Main:FindFirstChild("RGBBorder")
            if border then border.Visible = not border.Visible end
        end
    })

    return self
end

return setmetatable({}, Framework)
